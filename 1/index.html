<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CS180 Project 1 Gallery</title>
  <link rel="stylesheet" href="styles.css">
  <meta name="color-scheme" content="light dark">
  <meta name="description" content="Alignment and colorization results for Prokudin-Gorskii images">
  <meta name="robots" content="noindex, nofollow">
</head>
<body>
  <main class="page">
    <header class="header">
      <h1>Project 1: Images of the Russian Empire — Colorizing the Prokudin-Gorskii Photo Collection</h1>
    </header>

    <section class="section" id="intro">
      <h2>Overview</h2>
      <p>This project focuses on digitally reconstructing early 20th-century color photographs taken by Sergei Mikhailovich Prokudin-Gorskii. His method captured three sequential exposures of the same scene using red, green, and blue filters, which were later digitized by the Library of Congress. The task is to transform these stacked grayscale glass plate scans into coherent color images by automatically aligning the three channels.</p>
      <p>To achieve this, each plate is divided into equal thirds (corresponding to B, G, R channels), then aligned with translation-only shifts to minimize misregistration artifacts. Alignment is evaluated using image similarity metrics such as L2 norm or normalized cross-correlation (NCC), with exhaustive search used for small displacements. For larger, high-resolution images, a coarse-to-fine image pyramid approach is implemented to efficiently estimate alignment.</p>
    </section>

    <section class="section" id="part-1">
      <h2>(Part 1) Single-Scale Alignment</h2>
      <p>For the single-scale alignment, I implemented a naive algorithm which searches within a window of displacements and scores each attempt at alignment given a specific displacement vector using the L2 norm and NCC. The window I used was [-15, 15] pixels. Below are aligned results after single-scale alignment. Note that g=(dx, dy) and r=(dx, dy) refer to the displacement vectors for the green and red channels, respectively, where dx refers to the rows and dy refers to the columns.</p>

      <div class="row groups">
        <div class="group">
          <figure class="media">
            <img src="media/results/cathedral.jpg" alt="Cathedral aligned">
            <figcaption><strong>Cathedral — Aligned</strong><br>g=(5, 2), r=(12, 3) • time=0.80s</figcaption>
          </figure>
        </div>

        <div class="group">
          <figure class="media">
            <img src="media/results/tobolsk.jpg" alt="Tobolsk aligned">
            <figcaption><strong>Tobolsk — Aligned</strong><br>g=(3, 2), r=(6, 3) • time=0.82s</figcaption>
          </figure>
        </div>

        <div class="group">
          <figure class="media">
            <img src="media/results/monastery.jpg" alt="Monastery aligned">
            <figcaption><strong>Monastery — Aligned</strong><br>g=(-3, 2), r=(3, 2) • time=0.84s</figcaption>
          </figure>
        </div>
      </div>
    </section>

    <section class="section" id="part-2">
      <h2>(Part 2) Multi-Scale Alignment</h2>
      <p>For larger images, this naive search can become very slow. To address this, I implemented a Gaussian Pyramid. The Pyramid performs a cross-correlation operation using a Gaussian kernel to smoothly blur the image to prevent aliasing, after which the image is subsampled by a scale of 2. I repeat this until there are at least 100 pixels left in either dimension of the image. Note that due to the symmetry of the Gaussian kernel, the cross-correlation operation is equivalent to a convolution.</p>
      <p>Rather than use <code>cv.resize</code>, I decided to manually construct a Gaussian kernel and apply it to the image. I also decided not to use <code>np.sliding_windows</code> to apply the kernel, and instead wrote my own highly vectorized function that applies the Gaussian kernel. My implementation is around ~8 lines of code and <strong>achieves a 160x speedup (~0.2 sec) than applying the Gaussian kernel pixel-by-pixel naively (~25 sec)</strong>.</p>
      <p><strong>Problems encountered:</strong> In my multi-scale alignment implementation, I was finding that just using the Gaussian Pyramid by itself was not entirely sufficient for all images, since noisy edges corrupted the L2 / NCC scores. Thus, I decided to perform manual cropping on the edges of images. After playing around with some of the parameters (crop percentage, kernel size, Gaussian standard deviation, etc), I ended up using the following parameters for all images shown below: cropped the top and left sides by 4.3% and bottom and right sides by 4%, used a 5x5 kernel, with a standard deviation of 2.</p>

      <p>Below are the large TIF images produced using the parameters specified above and scored using NCC.</p>

      <div class="row groups">
        <div class="group">
          <figure class="media">
            <img src="media/results/emir.jpg" alt="emir aligned">
            <figcaption><strong>emir</strong><br>g=[49, 24], r=[104, 44] • time=9.05s</figcaption>
          </figure>
          <figure class="media">
            <img src="media/results/italil.jpg" alt="italil aligned">
            <figcaption><strong>italil</strong><br>g=[38, 21], r=[77, 35] • time=9.23s</figcaption>
          </figure>
          <figure class="media">
            <img src="media/results/church.jpg" alt="church aligned">
            <figcaption><strong>church</strong><br>g=[25, -11], r=[58, -5] • time=9.01s</figcaption>
          </figure>
        </div>

        <div class="group">
          <figure class="media">
            <img src="media/results/three_generations.jpg" alt="three_generations aligned">
            <figcaption><strong>three_generations</strong><br>g=[55, 13], r=[111, 10] • time=9.19s</figcaption>
          </figure>
          <figure class="media">
            <img src="media/results/lugano.jpg" alt="lugano aligned">
            <figcaption><strong>lugano</strong><br>g=[41, -17], r=[92, -28] • time=9.45s</figcaption>
          </figure>
          <figure class="media">
            <img src="media/results/melons.jpg" alt="melons aligned">
            <figcaption><strong>melons</strong><br>g=[83, 9], r=[177, 11] • time=9.33s</figcaption>
          </figure>
        </div>

        <div class="group">
          <figure class="media">
            <img src="media/results/lastochikino.jpg" alt="lastochikino aligned">
            <figcaption><strong>lastochikino</strong><br>g=[-3, -2], r=[76, -9] • time=9.87s</figcaption>
          </figure>
          <figure class="media">
            <img src="media/results/icon.jpg" alt="icon aligned">
            <figcaption><strong>icon</strong><br>g=[41, 17], r=[89, 23] • time=9.57s</figcaption>
          </figure>
          <figure class="media">
            <img src="media/results/siren.jpg" alt="siren aligned">
            <figcaption><strong>siren</strong><br>g=[49, -7], r=[96, -25] • time=9.70s</figcaption>
          </figure>
        </div>

        <div class="group">
          <figure class="media">
            <img src="media/results/self_portrait.jpg" alt="self_portrait aligned">
            <figcaption><strong>self_portrait</strong><br>g=[78, 26], r=[175, 34] • time=9.46s</figcaption>
          </figure>
          <figure class="media">
            <img src="media/results/harvesters.jpg" alt="harvesters aligned">
            <figcaption><strong>harvesters</strong><br>g=[60, 16], r=[125, 14] • time=9.09s</figcaption>
          </figure>
        </div>
      </div>
    </section>

    <section class="section" id="bonus">
      <h2><strong>Bonus Images</strong></h2>
      <p>This section contains a few examples from the Prokudin-Gorskii collection of my own choosing.</p>
      <div class="row groups">
        <div class="group">
          <figure class="media">
            <img src="media/results/bonus_1.jpg" alt="bonus_1 aligned">
            <figcaption><strong>bonus_1</strong><br>g=[56, 21], r=[122, 40] • time=9.66s</figcaption>
          </figure>
          <figure class="media">
            <img src="media/results/bonus_2.jpg" alt="bonus_2 aligned">
            <figcaption><strong>bonus_2</strong><br>g=[57, -29], r=[131, -58] • time=9.92s</figcaption>
          </figure>
          <figure class="media">
            <img src="media/results/bonus_3.jpg" alt="bonus_3 aligned">
            <figcaption><strong>bonus_3</strong><br>g=[33, 7], r=[114, 13] • time=9.98s</figcaption>
          </figure>
        </div>
      </div>
    </section>
  </main>
</body>
</html>

